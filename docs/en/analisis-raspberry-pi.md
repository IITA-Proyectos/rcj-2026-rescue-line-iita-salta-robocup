<!-- AUTO-GENERATED FILE – DO NOT EDIT.
     Source: docs/es (Spanish is source of truth)
     This file is generated by GitHub Actions.
-->

# Detailed Software Analysis: Raspberry Pi 4B

> **Author:** Ai Gemini - **Requested by:** Gustavo Viollaz  
> **Date:** February 22, 2026

## 1. Operational Analysis

The software for the Raspberry Pi is designed to be the image processing and high-level decision-making node. It is divided into two main logics: **Line Following** (Traditional OpenCV) and **Rescue Zone** (Deep Learning).

### Workflow
1.  **Asynchronous Capture:** The file `camthreader.py` separates frame capture from processing. This ensures that the processor always works with the most recent image, eliminating the delay from the hardware buffer.
2.  **Line Following:** 
    *   Uses the **Weighted Center of Mass** method. Black pixels at the bottom of the frame have more weight in the error calculation than those at the horizon.
    *   Detection of green intersections is performed using lateral ROIs (Region of Interest).
3.  **Rescue Zone:**
    *   Switches to an object detection model **YOLOv8** exported to **ONNX**.
    *   Implements a tracking system (Centroid Tracking) to maintain the identity of detected balls.

---

## 2. Identified Risks and Errors (Bugs & Risks)

### CRITICAL: Memory Management in Rescue
The function `modo_rescate()` loads the YOLO model every time it is invoked. 
*   **Impact:** This can cause the robot to stop for 3-5 seconds when entering the rescue zone. If the RAM becomes fragmented, the operating system could terminate the program due to lack of memory (OOM Killer).

### HIGH: Object Search Logic
If there are no targets in the frame during rescue mode, the robot has a default command to turn 90°.
*   **Impact:** The robot will turn aimlessly if the ball is out of its initial field of view, without a real exploration strategy.

### MEDIUM: Sensitivity to Lighting
The color thresholds (HSV/LAB) are static. 
*   **Impact:** The robot is vulnerable to changes in the lighting of the competition environment. The "Silver" color of the rescue entry is especially prone to being confused with white reflections.

---

## 3. Improvement Opportunities and Findings

1.  **Deferred Model Loading:** Move the initialization of YOLO to the beginning of the main script (`Main.py`) so that it only occurs once.
2.  **Integration of Distance Sensors:** Currently, the RPi "estimates" the distance to the ball based on its size in pixels. It is recommended to use readings from the **ToF (VL53L0X)** sensors of the Teensy to validate that the ball is actually in front of the claw before closing.
3.  **FPS Optimization:** Implement a dynamic search mask that only processes the area where the line was detected in the previous frame.
4.  **Communication Protocol:** Add a checksum to the data sent via Serial to prevent electrical noise from the motors from causing erratic movements.

---
*Document generated for the IITA Salta development team.*